<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlassBeats - YouTube Music Player</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, hsl(0 0% 0%) 0%, hsl(0 0% 5%) 100%);
            color: hsl(0 0% 98%);
            min-height: 100vh;
        }
        .glass {
            background: hsl(0 0% 8% / 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid hsl(45 100% 70% / 0.15);
            box-shadow: 0 8px 32px 0 hsl(0 0% 0% / 0.5);
        }
        .glass-highlight::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, hsl(45 100% 70% / 0.08), transparent);
        }
        .shadow-glow {
            box-shadow: 0 0 40px hsl(45 100% 70% / 0.25);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // Utility function
        const extractYouTubeId = (url) => {
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length === 11) ? match[7] : null;
        };

        // Storage helpers
        const storage = {
            getQueue: () => JSON.parse(localStorage.getItem('queue') || '[]'),
            setQueue: (queue) => localStorage.setItem('queue', JSON.stringify(queue)),
            getPlaylists: () => JSON.parse(localStorage.getItem('playlists') || '[]'),
            setPlaylists: (playlists) => localStorage.setItem('playlists', JSON.stringify(playlists)),
        };

        // Icons (simplified inline SVG)
        const PlayIcon = () => (
            <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"/>
            </svg>
        );

        const PauseIcon = () => (
            <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
            </svg>
        );

        const SkipBackIcon = () => (
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
            </svg>
        );

        const SkipForwardIcon = () => (
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 5l7 7-7 7M5 5l7 7-7 7" />
            </svg>
        );

        const ShuffleIcon = ({ active }) => (
            <svg className={`w-5 h-5 ${active ? 'text-yellow-400' : 'text-gray-400'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
            </svg>
        );

        const RepeatIcon = ({ mode }) => (
            <svg className={`w-5 h-5 ${mode !== 'off' ? 'text-yellow-400' : 'text-gray-400'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                {mode === 'one' && <text x="12" y="16" fontSize="10" fill="currentColor" textAnchor="middle">1</text>}
            </svg>
        );

        const VolumeIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
            </svg>
        );

        const TrashIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const PlusIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
        );

        // Main App Component
        function App() {
            const [queue, setQueue] = useState(storage.getQueue());
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isPlaying, setIsPlaying] = useState(false);
            const [volume, setVolume] = useState(50);
            const [isShuffle, setIsShuffle] = useState(false);
            const [repeatMode, setRepeatMode] = useState('off');
            const [playlists, setPlaylists] = useState(storage.getPlaylists());
            const [showPlaylists, setShowPlaylists] = useState(false);
            const [newPlaylistName, setNewPlaylistName] = useState('');
            const [urlInput, setUrlInput] = useState('');
            const [player, setPlayer] = useState(null);
            const [currentTime, setCurrentTime] = useState(0);
            const [duration, setDuration] = useState(0);

            const currentSong = queue[currentIndex];

            useEffect(() => {
                storage.setQueue(queue);
            }, [queue]);

            useEffect(() => {
                storage.setPlaylists(playlists);
            }, [playlists]);

            // Load YouTube API
            useEffect(() => {
                const tag = document.createElement('script');
                tag.src = 'https://www.youtube.com/iframe_api';
                const firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                window.onYouTubeIframeAPIReady = () => {
                    console.log('YouTube API Ready');
                };
            }, []);

            // Initialize player when song changes
            useEffect(() => {
                if (currentSong && window.YT) {
                    if (player) {
                        player.loadVideoById(currentSong.youtubeId);
                        if (isPlaying) player.playVideo();
                    } else {
                        const newPlayer = new YT.Player('youtube-player', {
                            height: '0',
                            width: '0',
                            videoId: currentSong.youtubeId,
                            playerVars: { controls: 0 },
                            events: {
                                onReady: (event) => {
                                    setPlayer(event.target);
                                    setDuration(event.target.getDuration());
                                    if (isPlaying) event.target.playVideo();
                                },
                                onStateChange: (event) => {
                                    if (event.data === YT.PlayerState.ENDED) {
                                        playNext();
                                    }
                                }
                            }
                        });
                    }
                }
            }, [currentSong]);

            // Update current time
            useEffect(() => {
                const interval = setInterval(() => {
                    if (player && isPlaying) {
                        setCurrentTime(player.getCurrentTime());
                    }
                }, 1000);
                return () => clearInterval(interval);
            }, [player, isPlaying]);

            const addFromUrl = () => {
                const videoId = extractYouTubeId(urlInput);
                if (!videoId) {
                    alert('Invalid YouTube URL');
                    return;
                }

                const song = {
                    id: Date.now().toString(),
                    title: 'YouTube Video',
                    artist: 'Unknown Artist',
                    youtubeId: videoId,
                    thumbnail: `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`
                };

                setQueue([...queue, song]);
                setUrlInput('');
            };

            const removeFromQueue = (index) => {
                const newQueue = queue.filter((_, i) => i !== index);
                setQueue(newQueue);
                if (index < currentIndex) {
                    setCurrentIndex(currentIndex - 1);
                } else if (index === currentIndex) {
                    setCurrentIndex(0);
                }
            };

            const playNext = () => {
                if (repeatMode === 'one') {
                    player?.seekTo(0);
                    return;
                }

                if (currentIndex < queue.length - 1) {
                    setCurrentIndex(currentIndex + 1);
                } else if (repeatMode === 'all') {
                    setCurrentIndex(0);
                } else {
                    setIsPlaying(false);
                }
            };

            const playPrevious = () => {
                if (currentIndex > 0) {
                    setCurrentIndex(currentIndex - 1);
                }
            };

            const togglePlayPause = () => {
                if (player) {
                    if (isPlaying) {
                        player.pauseVideo();
                    } else {
                        player.playVideo();
                    }
                    setIsPlaying(!isPlaying);
                }
            };

            const handleVolumeChange = (e) => {
                const newVolume = parseInt(e.target.value);
                setVolume(newVolume);
                if (player) player.setVolume(newVolume);
            };

            const handleSeek = (e) => {
                const newTime = parseFloat(e.target.value);
                if (player) player.seekTo(newTime);
                setCurrentTime(newTime);
            };

            const toggleRepeat = () => {
                if (repeatMode === 'off') setRepeatMode('all');
                else if (repeatMode === 'all') setRepeatMode('one');
                else setRepeatMode('off');
            };

            const createPlaylist = () => {
                if (!newPlaylistName.trim()) return;
                const playlist = {
                    id: Date.now().toString(),
                    name: newPlaylistName,
                    songs: []
                };
                setPlaylists([...playlists, playlist]);
                setNewPlaylistName('');
            };

            const addToPlaylist = (playlistId, song) => {
                setPlaylists(playlists.map(p =>
                    p.id === playlistId ? { ...p, songs: [...p.songs, song] } : p
                ));
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            return (
                <div className="min-h-screen p-4 md:p-8">
                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className="mb-8">
                            <h1 className="text-4xl md:text-5xl font-bold bg-gradient-to-r from-yellow-400 to-yellow-600 bg-clip-text text-transparent">
                                GlassBeats
                            </h1>
                            <p className="text-gray-400 mt-2">Your YouTube Music Player</p>
                        </div>

                        {/* Add Song Section */}
                        <div className="glass glass-highlight relative rounded-xl p-6 mb-6">
                            <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
                                <span className="text-yellow-400">ðŸ”—</span>
                                Add from YouTube
                            </h3>
                            <div className="flex gap-2">
                                <input
                                    type="text"
                                    placeholder="Paste YouTube URL here..."
                                    value={urlInput}
                                    onChange={(e) => setUrlInput(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && addFromUrl()}
                                    className="flex-1 bg-gray-900 border border-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:border-yellow-400 transition-colors"
                                />
                                <button
                                    onClick={addFromUrl}
                                    className="bg-gradient-to-r from-yellow-400 to-yellow-600 text-black font-semibold px-6 py-2 rounded-lg hover:opacity-90 transition-opacity"
                                >
                                    <PlusIcon />
                                </button>
                            </div>
                        </div>

                        {/* Now Playing & Controls */}
                        {currentSong && (
                            <div className="glass glass-highlight relative rounded-xl p-6 mb-6">
                                <div className="flex items-center gap-6 mb-6">
                                    <img
                                        src={currentSong.thumbnail}
                                        alt={currentSong.title}
                                        className="w-20 h-20 rounded-lg shadow-lg"
                                    />
                                    <div className="flex-1 min-w-0">
                                        <h2 className="text-lg font-bold truncate">{currentSong.title}</h2>
                                        <p className="text-sm text-gray-400 truncate">{currentSong.artist}</p>
                                    </div>
                                </div>

                                {/* Player Controls */}
                                <div className="space-y-4">
                                    <div className="flex items-center justify-center gap-4">
                                        <button
                                            onClick={() => setIsShuffle(!isShuffle)}
                                            className="p-2 hover:bg-gray-800 rounded-full transition-colors"
                                        >
                                            <ShuffleIcon active={isShuffle} />
                                        </button>

                                        <button
                                            onClick={playPrevious}
                                            className="p-2 hover:bg-gray-800 rounded-full transition-colors"
                                        >
                                            <SkipBackIcon />
                                        </button>

                                        <button
                                            onClick={togglePlayPause}
                                            className="w-12 h-12 rounded-full bg-yellow-400 hover:bg-yellow-500 text-black transition-all shadow-glow flex items-center justify-center"
                                        >
                                            {isPlaying ? <PauseIcon /> : <PlayIcon />}
                                        </button>

                                        <button
                                            onClick={playNext}
                                            className="p-2 hover:bg-gray-800 rounded-full transition-colors"
                                        >
                                            <SkipForwardIcon />
                                        </button>

                                        <button
                                            onClick={toggleRepeat}
                                            className="p-2 hover:bg-gray-800 rounded-full transition-colors"
                                        >
                                            <RepeatIcon mode={repeatMode} />
                                        </button>
                                    </div>

                                    {/* Progress Bar */}
                                    <div className="space-y-2">
                                        <input
                                            type="range"
                                            min="0"
                                            max={duration || 100}
                                            value={currentTime}
                                            onChange={handleSeek}
                                            className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"
                                            style={{
                                                background: `linear-gradient(to right, #fbbf24 0%, #fbbf24 ${(currentTime / duration) * 100}%, #374151 ${(currentTime / duration) * 100}%, #374151 100%)`
                                            }}
                                        />
                                        <div className="flex justify-between text-xs text-gray-400">
                                            <span>{formatTime(currentTime)}</span>
                                            <span>{formatTime(duration)}</span>
                                        </div>
                                    </div>

                                    {/* Volume Control */}
                                    <div className="flex items-center gap-3">
                                        <VolumeIcon />
                                        <input
                                            type="range"
                                            min="0"
                                            max="100"
                                            value={volume}
                                            onChange={handleVolumeChange}
                                            className="w-24 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"
                                            style={{
                                                background: `linear-gradient(to right, #fbbf24 0%, #fbbf24 ${volume}%, #374151 ${volume}%, #374151 100%)`
                                            }}
                                        />
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Queue */}
                        <div className="glass glass-highlight relative rounded-xl p-6">
                            <h3 className="text-lg font-semibold mb-4">Queue ({queue.length})</h3>
                            {queue.length === 0 ? (
                                <div className="text-center py-12 text-gray-400">
                                    <p>Queue is empty</p>
                                    <p className="text-sm mt-2">Add YouTube videos to start playing</p>
                                </div>
                            ) : (
                                <div className="space-y-2 max-h-96 overflow-y-auto">
                                    {queue.map((song, index) => (
                                        <div
                                            key={song.id}
                                            className={`group flex items-center gap-3 p-3 rounded-lg transition-all ${
                                                index === currentIndex
                                                    ? 'bg-yellow-400/20 border border-yellow-400/30'
                                                    : 'hover:bg-gray-800/30'
                                            }`}
                                        >
                                            <img
                                                src={song.thumbnail}
                                                alt={song.title}
                                                className="w-14 h-14 rounded-lg cursor-pointer"
                                                onClick={() => setCurrentIndex(index)}
                                            />
                                            <div className="flex-1 min-w-0">
                                                <p className="font-medium truncate">{song.title}</p>
                                                <p className="text-sm text-gray-400 truncate">{song.artist}</p>
                                            </div>
                                            <button
                                                onClick={() => removeFromQueue(index)}
                                                className="opacity-0 group-hover:opacity-100 p-2 hover:bg-red-500/20 rounded-full transition-all"
                                            >
                                                <TrashIcon />
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Hidden YouTube Player */}
                    <div id="youtube-player" style={{ display: 'none' }}></div>
                </div>
            );
        }

        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
